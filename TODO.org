* TODO Refactor first Itinerary MAP - Cuba1 :
 ... without Maria La Gorda itinerary

* PROCESS Create second Itinerary MAP - Cuba2
See itinerary details: [[file:README.org::*CUBA2]]

** DONE [0] Keep existing western route, remove Trinidad → Habana loop
Marcel's requirement: Keep Viñales, Soroa, Playa Larga, Trinidad route intact,
but remove the S-curve closing loop from Trinidad back to Habana.

Action plan:
- [X] Locate drawSCurveRoute() call for Trinidad → Habana in map.js (map.js:348-352)
- [X] Comment out or remove the Trinidad → Habana S-curve route
- [X] Verify María la Gorda ↔ Viñales bidirectional route remains
- [X] Test that western route stops at Trinidad (Habana → Viñales → Soroa → Playa Larga → Cienfuegos → Trinidad)
- [X] Ensure all existing city markers remain visible

Status: Completed. Trinidad → Habana loop removed. Route now ends at Trinidad.

** DONE Add 5 new cities to cuba-locations-geojson.json
- [X] Camagüey (21.38°N, -77.92°W)
- [X] Santiago de Cuba (20.0247°N, -75.8219°W)
- [X] Baracoa (20.3475°N, -74.5024°W)
- [X] Faro de Maisi (20.2089°N, -74.1336°W - extreme east point)
- [X] Yumurí / Boca de Yumurí (20.3009°N, -74.2976°W)

** DONE Add eastern extension routes
- [X] Trinidad → Camagüey (map.js:384-386)
- [X] Camagüey → Santiago de Cuba (map.js:388-390)
- [X] Santiago de Cuba → Baracoa (map.js:392-394)
- [X] Baracoa ↔ Santiago de Cuba (bidirectional with double arrows) (map.js:396-399)
- [X] Santiago de Cuba → Habana (straight nightbus line) (map.js:401-404)
- [X] Add Camagüey and Santiago de Cuba to CUBA2 cities list (map.js:432)
- [X] Add label positioning for new cities (map.js:491-496)

** DONE Optional: Add eastern circular loop (anti-clockwise)
- [X] Baracoa → Faro de Maisi (south)
- [X] Faro de Maisi → Yumurí
- [X] Yumurí → Baracoa (completing the loop)

** DONE Add toggle functionality to switch between itineraries
- [X] Add CUBA1 and CUBA2 toggle buttons to index.html
- [X] Implement clearMap() function to remove routes/markers
- [X] Modify initializeMap() to accept itinerary parameter
- [X] Set cities to show based on itinerary (CUBA1 vs CUBA2)
- [X] Conditionally draw eastern loop only for CUBA2
- [X] Wire up toggle button click handlers
- [X] Update export filename to include itinerary name

** DONE Create separate files for CUBA2 (clean start from scratch)
- [X] Create index2.html for CUBA2
- [X] Create map2.js for CUBA2
- [X] Add all 11 CUBA2 city markers (no routes yet)
- [X] Reuse cuba.svg base map
- [X] Export button wired to save as cuba-map2-west-to-east.svg

** DONE Clarify CUBA2 itinerary with Marcel
Questions to ask:
- Does CUBA2 start from Habana or directly from Viñales? : START AT HABANA, THEN VINALES ETC
- Should Cienfuegos be included (between Playa Larga and Trinidad)?: YES
- Is María la Gorda bidirectional route in CUBA2 or only CUBA1? DO NOT include MARIA LA GORDA in any of the itineraries

** DONE Add routes to CUBA2 once itinerary confirmed
Based on Marcel's confirmed requirements:
- [X] Habana → Viñales → Soroa → Playa Larga → Cienfuegos → Trinidad (map2.js:247-269)
- [X] Trinidad → Camagüey → Santiago de Cuba → Baracoa (map2.js:273-285)
- [X] Baracoa ↔ Santiago de Cuba (bidirectional) (map2.js:288-290)
- [X] Santiago de Cuba → Habana (straight nightbus, curvature=0) (map2.js:293-295)
- [X] Optional: Baracoa → Faro de Maisi → Yumurí → Baracoa (circular loop) (map2.js:298-311)

** TODO Test all routes stay 100% inland
Especially check the long Santiago de Cuba → Habana nightbus route

** TODO CRITICAL: Fix coordinate/map projection mismatch
*** Problem
City markers are incorrectly positioned on the map. Many cities appear in the water instead of on land.

Evidence: See Screenshots/CubaMap2.3.png
- Santiago de Cuba appears in the sea (south coast)
- Should be inland on the southeast coast

*** Root Cause
Mismatch between:
1. GeoJSON coordinates (real lat/lng): Santiago = 20.0247°N, -75.8219°W
2. SVG base map projection/coordinate system
3. latLngToSVG() conversion function using incorrect bounds or formula

*** Investigation needed
- [ ] Verify cuba.svg projection type (Mercator? Equirectangular? Custom?)
- [ ] Check actual SVG path data to find real Santiago position in cuba.svg
- [ ] Calibrate CUBA_BOUNDS constants to match SVG projection
- [ ] Test conversion with known accurate cities (Habana should be on north coast)
- [ ] Adjust OFFSET values if needed

*** Current conversion (map2.js:46-66)
#+begin_src javascript
const CUBA_BOUNDS = {
  north: 23.4,
  south: 19.6,
  west: -85.2,
  east: -73.9
};
const OFFSET = { x: 0, y: 40 };
#+end_src

May need different bounds or transformation formula.

** TODO Refactor CUBA2 to reuse western routes from CUBA1
*** Problem
CUBA2 is redrawing routes for Habana → Viñales → Soroa → Playa Larga → Cienfuegos → Trinidad even though these EXACT same routes already exist in CUBA1 (map.js).

This violates DRY principle (Don't Repeat Yourself).

*** Current situation
- map.js (CUBA1): Has working routes with tested curvature values
- map2.js (CUBA2): Duplicates the same route code with same curvature values

*** Action items
- [ ] Extract western route definitions into shared module or function
- [ ] Import/reuse western routes in both map.js and map2.js
- [ ] Keep only CUBA2-specific eastern routes in map2.js:
  - Trinidad → Camagüey → Santiago de Cuba → Baracoa
  - Baracoa ↔ Santiago de Cuba (bidirectional)
  - Santiago de Cuba → Habana (nightbus)
  - Optional eastern loop
- [ ] Consider creating routes-config.js with route definitions

*** Benefits
- Single source of truth for western routes
- Easier maintenance (change once, apply everywhere)
- Reduced code duplication
- Smaller bundle size

* WAIT Update export functionality (2nd priority )
Ensure SVG export works correctly with all new routes and cities 
